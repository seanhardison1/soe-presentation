---
title: "State of the Ecosystem:"
subtitle: "Reporting on Northeast Continental Shelf<br> ecosystem status and trends."
author: "Sean Hardison<br /> Ecosystem Dynamics and Assessment <br /> Northeast Fisheries Science Center"
output:
  xaringan::moon_reader:
    css: ["default", "libs/my-theme.css"]
    lib_dir: libs
    nature:
      titleSlideClass: ["right", "middle", "my-title"]
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
  revealjs::revealjs_presentation:
    self_contained: false
    reveal_plugins: ["notes", "search"]
---
class: top, left

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
#Plotting and data libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(ecodata)
library(here)
library(kableExtra)
library(ggrepel)
library(stringr)
library(patchwork)
library(grid)
library(ggiraph)
library(vegan)
library(rpart)

#GIS libraries
library(sf)
library(rgdal)
library(raster)
library(rnaturalearth)

data.dir <- here::here("data")


#Time series constants
shade.alpha <- 0.3
shade.fill <- "lightgrey"
lwd <- 1
pcex <- 2
trend.alpha <- 0.5
trend.size <- 2
hline.size <- 1
hline.alpha <- 0.35
hline.lty <- "dashed"
label.size <- 5
hjust.label <- 1.5
letter_size <- 4
feeding.guilds <- c("Apex Predator","Piscivore","Planktivore","Benthivore","Benthos")
x.shade.min <- 2009
x.shade.max <- 2018
map.lwd <- 0.4
#Function for custom ggplot facet labels
label <- function(variable,value){
  return(facet_names[value])
}

```

# Today's seminar

.pull-left[

- What is Ecosystem Reporting and why does it matter?

- The role of State of the Ecosystem Reporting in the Northeast US

- Report structure

- Highlights from the 2019 Mid-Atlantic and New England reports

- Methods: An open-source approach to ecosystem reporting
]

.pull-right[
*The IEA Loop*
![iea-loop](iea-loop.png)


]

---

# Ecosystem Status Reporting (ESR)


What is ecosystem reporting?

*  Ecosystem reporting provides ecosystem-context to resource managers

* All Integrated Ecosystem Assessment regions in the US develop similar documents in varying guises

--

.pull-left[
*IEA Regions*
![iea-region](images/iea-regions.png)
]

.pull-right[
*Ecosystem Status Reports*
![regional-esrs](images/esr-breakdown.png)
]


???

---

# ESRs in the Northeast US

* In the Northeast, we create **State of the Ecosystem (SOE)** reports
  - Short (< 30 pages), higher-level documents aimed at sharing relavent ecosystem-information with resource managers
  
  - Documents provided annually to:
      1. **Mid-Atlantic Fishery Management Council (MAFMC)** 
      2. **New England Fishery Management Council (NEFMC)** 

*SOE in action*
![soe-snippet](images/soe-snippet.png)

---

## ESRs in the Northeast US
<!-- 1. Identify changes to ecosystem components within context of management -->

<!-- 2. Potential for propapgation of change -->
```{r nes-comp1, echo = F}
knitr::include_graphics("images/nes-components.png")
```



???
The information that SOE reports provide to managers broadly applies to ecosystem components, which are show in bold here. This includes local social systems, marine communities, human activities, management objectives, marine habitats, and environmental drivers. 
---

## ESRs in the Northeast US

Objectives of SOEs:

1. Identify changes to ecosystem components within context of management

1. Identify the potential for change to propagate to other ecosystem components

1. Highlight "red flags" and potential regime shifts


```{r nes-comp2, echo = F, out.width = "80%", fig.align = "center"}
knitr::include_graphics("images/nes-components-abstracted.png")
```

???
Linking these components together within the context of fisheries management is an important goal of State of the Ecosystem reporting. We want to  

---

## ESRs in the Northeast US: Relevance to management

**Why should managers care about an ecosystem perspective to resource management?**

--

Well-informed management decisions rely upon knowledge of the ecosystem being managed
* Reporting on ecosystem condition can set the stage for quota deliberations<sup>1</sup> (e.g. AFSC Ecosystem Report Cards)

--

An ecosystem perspective is important for managing in the face of rapid, unprecedented ecosystem changes

.pull-left[

```{r long-term sst, echo = F, fig.height=4}

lt_sst <- ecodata::long_term_sst %>% 
  mutate(hline = mean(Value))

lt_sst %>% 
  ggplot(aes(x = Time, y = Value, group = Var)) +
         annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = -Inf, ymax = Inf) +
  geom_gls() +
  geom_line() +
  geom_point() +
  ylab("Temperature (°C)") +
  # ggtitle("") +
    scale_x_continuous(expand = c(0.01, 0.01), breaks = seq(1840,2010,20))+
      geom_hline(aes(yintercept = hline),
           size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty)+
  theme_facet() +
  theme(strip.text=element_text(hjust=0,
                                face = "italic"))

```
*NE Shelf Long-term SST*
]

.pull-right[
```{r GSI, fig.height = 4, echo = F}
gsi %>% 
  mutate(Year = floor(Time)) %>% 
  group_by(Year) %>% 
  dplyr::summarise(Value = mean(Value)) %>% 
  mutate(hline = mean(Value)) %>% 
  dplyr::rename(Time = Year) %>% 
  ggplot(aes(x = Time, y = Value)) +
         annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = -Inf, ymax = Inf) +
  geom_gls() +
  geom_line() +
  geom_point() +
  ylab("Gulf Stream position anomaly") +
  # ggtitle("") +
    scale_x_continuous(expand = c(0.01, 0.01))+
      geom_hline(aes(yintercept = hline),
           size = hline.size,
           alpha = hline.alpha,
           linetype = hline.lty)+
  theme_ts() +
  theme(strip.text=element_text(hjust=0,
                                face = "italic"))
```
*Gulf Stream Index*
]
.references[
.footnote[
[1] Zador, Stephani G., et al. "Ecosystem considerations in Alaska: the value of qualitative assessments." ICES Journal of Marine Science 74.1 (2017): 421-430.
]
]
---

## ESRs in the Northeast US: Relevance to management

Ecosystem conditions affect fisheries yield 

By providing ESRs to managers, we continue to move towards Ecosystem-based Management strategies to meet sustainability and conservationist goals laid out by the Magnuson-Stevens Act.

* Marine ecosystems in high productivity states may be more resilient to extractive pressures and climate change than those in lower productivity states.
  - EBFM is a way to meet ecosystem objectives while remaining sustainable 





---
## SOE reporting: quantifying change

Status (short-term) and trend (long-term) of components are measured as **indicators**

Indicators are selected to

1. Be broadly informative about a component in a management context<sup>1-3</sup>

1. Minimize redundancy of information

1. Be responsive to ecosystem change


.footnote[
[1] Rice J. C.Rochet M. J. "A framework for selecting a suite of indicators for fisheries management." ICES Journal of Marine Science 62 (2005): 516–527.

[2] Link J. 2010. Ecosystem-Based Fisheries Management: Confronting Tradeoffs . Cambridge University Press, New York.

[3] Zador, Stephani G., et al. "Ecosystem considerations in Alaska: the value of qualitative assessments." ICES Journal of Marine Science 74.1 (2017): 421-430.
]

--

```{r, echo = F, fig.align = "center", fig.height = 3, fig.width=8}

#Filter data into two dataframes for plotting
indicators <- ecodata::bennet %>% 
  filter(EPU %in% "GB",
         Var %in% c("VI EPU aggregate",
                    "PI EPU aggregate")) %>% 
  mutate(Var, Var = plyr::mapvalues(Var, from = c("VI EPU aggregate","PI EPU aggregate"),
                                    to = c("Volume","Price")))

revchange <- ecodata::bennet %>% 
  filter(EPU %in% "GB",
         Var %in% c("REVCHANGE EPU aggregate"))

#custom bar fill color (color-blind friendly)
ind_fill <- c("#a6cee3", "#b2df8a")

#limits
y.lim <- c(-350,350)

#plot
gb_bennet <- indicators %>%
ggplot()+
  
  #Highlight last ten years
  annotate("rect", fill = shade.fill, alpha = shade.alpha,
      xmin = x.shade.min , xmax = x.shade.max,
      ymin = -Inf, ymax = Inf)+
  
  geom_bar(aes(x=Time, y= Value, fill = Var), stat="identity")+
  scale_fill_manual(name = "Indicators", values = ind_fill) +
  geom_line(data = revchange[revchange$EPU == "GB",], aes(x = Time, y = Value, colour="$"))+
  scale_colour_grey(name ="Revenue Change") +
  ggtitle("Georges Bank Commercial Landings")+
  labs(y="Value $1,000,000 ($2015)") +
  scale_x_continuous(breaks = seq(1965, 2015, by = 10), expand = c(0.01, 0.01)) +
  scale_y_continuous(breaks = seq(y.lim[1], y.lim[2], by = 100), limits = y.lim, expand = c(0.01, 0.01)) +
  theme_ts() +
  theme(title = element_text(size = 10))

gb_bennet

```





---
## SOE reporting: ecosystem indicators

```{r management-objectives, echo = F}

mng_obj <- data.frame("Objective Categories" = c("Seafood Production",
                                                 "Profits","Recreation",
                                                 "Stability","Social & Cultural",
                                                 "Biomass","Productivity",
                                                 "Trophic structure","Habitat"),
"Indicators" = c("Landings by feeding guild","Revenue by feeding guild",
                               "Number of anglers and trips; recreational catch",
                               "Diversity indices (fishery and species)",
                               "Commercial and recreational reliance",
                 "Biomass or abundance by feeding guild from surveys",
                               "Condition and recruitment of managed species",
                               "Relative biomass of feeding guilds, primary productivity",
                               "Estuarine and offshore habitat conditions"))

knitr::kable(mng_obj,
      col.names = c("Objective Categories","Indicators"),
      caption = "Ecosystem-scale objectives and indicators on the Northeast US shelf") %>%
  kableExtra::kable_styling(full_width = F) %>%
 # column_spec(c(2), width = c("25em")) %>%
  row_spec(0, bold = TRUE)
```

---
## SOE reporting: indicator spatial scales

```{r EPU-MAP, eval  = F, echo = F}
crs <- "+proj=longlat +lat_1=35 +lat_2=45 +lat_0=40 +lon_0=-77 +x_0=0 +y_0=0 +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0"

#Coastline shapefile
coast <- ne_countries(scale = 10,
                          continent = "North America",
                          returnclass = "sf") %>%
             sf::st_transform(crs = crs)

#State polygons
ne_states <- ne_states(country = "united states of america",
                                      returnclass = "sf") %>%
  sf::st_transform(crs = crs)

load(file.path(data.dir, "epu_no_estuaries.rdata"))

# Set lat/lon window for map
xmin = -77
xmax = -65
ymin = 36
ymax = 45
xlims <- c(xmin, xmax)
ylims <- c(ymin, ymax)

#CRS
crs <- "+proj=longlat +lat_1=35 +lat_2=45 +lat_0=40 +lon_0=-77 +x_0=0 +y_0=0 +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0"

#Specify data frame with lat/lon locations for labels
epu_labels <- data.frame(EPU = c("Mid-Atlantic\n Bight",
                                 "Gulf of Maine",
                                 "Georges Bank"),
                         latitude = c(40,42.85,41),
                         longitude = c(-72.55,-69,-68.5))

#Map of NE LME
 
  ggplot() +
  geom_sf(data = epu_sf, aes(fill = EPU), size = map.lwd) +
  geom_sf(data = coast, size = map.lwd) +
  
  coord_sf(crs = crs, xlim = xlims, ylim = ylims) +
  geom_text(data = epu_labels, aes(x = longitude,
                                    y = latitude,
                                    label = EPU),
            size = 4.5)+
  guides(fill = FALSE) +
  scale_fill_brewer() +
  theme_map() +
  ggtitle("Ecological Production Units on the Northeast Shelf") +
  xlab("Longitude") +
  ylab("Latitude")

```

.left-column[
* Indicators reported on coastwide to state-level scale

* Georges Bank and Gulf of Maine are reported in New England document

]

.right-column[
```{r epu-map-image, fig.align = "center", echo = F, fig.height = 6}
knitr::include_graphics("images/epu-layout.png")
```
]

---
